## はじめに

ユーザー設定用のトークンとそれに対応するダイジェストを保存する

- 全体の流れ

    1. ユーザーがパスワードの再設定をリクエストすると、ユーザーが送信したメールアドレスをキーにしてデータベースからユーザーを見つける

    2. 該当のメールアドレスがデータベースにある場合は、再設定用トークンとそれに対応する再設定ダイジェストを生成する

    3. 再設定用ダイジェストはデータベースに保存しておき、再設定用トークンはメールアドレスと一緒に、ユーザーに送信する有効化用メールのリンクに仕込んでおく

    4. ユーザーがメールのリンクをクリックしたら、メールアドレスをキーとしてユーザーを探し、データベース内に保存しておいた再設定用ダイジェストと比較する（トークンを認証する）

    5. 認証に成功したら、パスワード変更用のフォームをユーザーに表示する

## 12.1PasswordResetsリソース

## 12.1.1 PasswordResetsコントローラ

## 12.1.2 新しいパスワードの設定

パスワードの再設定
トークン用の仮想的な属性とそれに対応するダイジェストを用意

→トークンをハッシュ化しておくこと

再設定用のリンクは短時間（数時間以内）で期限切れにすること

## 12.1.3 createアクションでパスワード再設定

パスワード再設定をする流れ

1. 再設定用の画面からデータを送信

2. メールアドレスをキーとしてデータベースを参照

3. 再設定用トークンと送信時のタイムスタンプでデータベースを更新

4. ルートURLへリダイレクト

5. フラッシュメッセージをユーザーに表示

6. 送信が無効の場合→newページを出力

## 12.2パスワード再設定のメール送信

a